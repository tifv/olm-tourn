\problem\problemscore{9}
В ряд стоит 2012 блюдечек, пронумерованных от 1 до 2012.
На $k$-ом блюде лежит ровно $k$ орехов.
Двое играют в игру.
За ход разрешается переложить любое число (не меньше одного) орехов с $m$-го
блюда на $(m - 1)$-ое (где $m$ выбирается от 2 до 2012 на усмотрение игрока),
либо забрать с первого блюда любое число (тоже не меньше одного) орехов.
Проигрывает тот, кто не может сделать ход.
Кто выиграет при правильной игре?
\solution
Рассмотрим теорию \emph{игры Ним.}
Пусть имеются кучки с $a_1$, $a_2$, $\ldots$, $a_n$ камнями.
За ход разрешается брать из любой кучки любое число камней.
Проигрывает тот, кто не может сделать хода.
Отметим, что эта игра конечна, так как не более чем за
$a_1 + a_2 + \ldots + a_n$ ходов все камни будут взяты.
Это означает, что позиции в ней могут быть проанализированы.
Изучим структуру выигрышных и проигрышных позиций в этой игре.
Для этого введем в~рассмотрение операцию $\oplus$.
Пусть два числа $x$ и $y$ представлены в двоичной системе счисления и при этом
в их записи поровну разрядов
(для этого, если нужно, в начало меньшего числа напишем нули).
Сложим эти числа побитно (без переносов) и результат
(также число в двоичной системе) будем обозначать через $x \oplus y$
% spell "XOR" -> "исключающее или"
(это сложение --- аналог операции XOR в программировании).
Докажем следующую (интересную саму по себе) теорему:
\par
\emph{Теорема.}
Проигрышные позиции в игре Ним~--- это в точности такие наборы количеств
камней в кучках $a_1$, $a_2$, $\ldots$, $a_n$, что
$a_1 \oplus a_2 \oplus a_3 \ldots \oplus a_n = 0$.
\\\emph{Доказательство теоремы.}
Докажем теорему индукцией по суммарному количеству камней во всех кучках.
Вспомним, во-первых, что выигрышные позиции~--- это такие, из которых есть ход
в проигрышную позицию, а проигрышные позиции~--- это такие, из которых любой
ход ведет в выигрышную
(терминология обусловлена тем, что начинающий с проигрышной позиции
проигрывает, а с выигрышной~--- выигрывает).
Будем доказывать, что описанные в формулировке позиции~--- это в точности все
проигрышные.
Заметим, что позиция, в которой во всех кучках ноль камней, проигрышная
(из неё нельзя сделать ход) и при этом $\oplus$-сумма как раз равна нулю.
Теперь покажем, что любой ход из позиции, в которой
сумма $a_1 \oplus a_2 \oplus \ldots \oplus a_n$ равна нулю, ведет в позицию,
в которой эта сумма не ноль.
Пусть мы взяли $k$ камней из первой кучки.
Заметим, что в двоичном разложении числа $a_1 - k$ не могут быть единицы на тех
же местах, что и в числе $a_1$, так как иначе бы оно было не меньше исходного.
Отсюда мы получаем, что новая позиция выигрышная по предположению индукции.
Теперь рассмотрим позицию, в которой сумма
$a_1 \oplus a_2 \oplus \ldots \oplus a_n$ не равна нулю.
Покажем, что можно сделать ход так, чтобы она стала нулем.
Для этого найдем наибольший разряд (двоичного разложения), в котором побитная
сумма не ноль.
Это значит, что есть кучки, у которых в двоичном представлении в этом разряде
тоже единица.
Пусть такая кучка~--- это $a_1$.
Изменим её следующим образом: обнулим тот (самый большой) разряд, в котором
$\oplus$--сумма не ноль, и изменим все биты, в которых так же $\oplus$--сумма
была не ноль.
Новая сумма будет ноль, и, кроме того, ясно, что мы уменьшили кучку $a_1$.
Таким образом, мы доказали теорему по индукции.
\par
Теперь рассмотрим \emph{игру Ним с пополнением.}
Отличие от обычной игры состоит в том, что кучки можно как уменьшать, так и
увеличивать.
Ясно, что если не вводить никаких ограничений на ходы, увеличивающие кучки, то
такая игра не будет конечной.
Будем считать, что есть некоторое ограничение, из которого следует, что число
увеличивающих ходов будет конечно.
Тогда такая игра совершенно не отличается от рассмотренной, мы просто на все
ходы, увеличивающие кучки, будем отвечать уменьшением на то же число, на
которое только что увеличил другой игрок.
Таким образом, в такой игре проигрышные позиции описываются аналогично.
\par
Наконец сведем нашу игру к описанной выше игре Ним с пополнением.
Для этого мы будем рассматривать только блюдца с нечетными номерами, а на
блюдца с четными номерами не будем обращать внимание.
Заметим, что наша игра конечна
(полуинвариантом является, например, сумма номеров блюдец, посчитанная по всем
орехам~--- ясно что такая сумма целая и с каждым ходом уменьшается).
Значит, в нашей игре будет всего лишь конечное число ходов и тем более лишь
конечное число ходов из блюдец с четными номером в блюдца с нечетными.
Такой ход мы будем рассматривать просто как увеличение.
Тогда мы просто свели игру к игре Ним на кучках 1, 3, $\ldots$, 2011.
Посчитаем побитную сумму этих чисел.
Их 1006 и все они нечетны, значит, в последнем разряде сумма ноль.
Вычтем из всех чисел 1 и поделим на 2.
Получим числа от 0 до 1005.
Их сумма нечетна, и, следовательно, у исходных чисел сумма во втором разряде
не ноль.
Значит, эта позиция выигрышная, и выиграет первый игрок.
\endproblem
