\usepackage{jeolm}
\usepackage{jeolm-olymp}
\usepackage[T2A]{fontenc}
\usepackage[utf8x]{inputenc}

\usepackage{mathabx}

% default figures placement
\def\fps@figure{bp}
\def\fps@table{bp}

% \ifdigits
\newcommand\ifdigits[1]{\jeolm@if@digits1#1\jeolm@stop@digits\end@digits}
\let\jeolm@stop@digits\relax
\def\jeolm@if@digits#1#2\end@digits{\ifthenelse{`#1 < `0 \OR `#1 > `9}%
    {\iffalse}%
    {%
        \ifthenelse{\equal{#2}{\jeolm@stop@digits}}%
            {\iftrue}%
            {\jeolm@if@digits#2\end@digits}%
    }}

% \problemscore
\newcounter{problem@score}
\newcommand\problemscore[1]{%
    \ifdigits{#1}\addtocounter{problem@score}{#1}\fi
    \textsf{(#1)}}
\newcommand\problemscoresum{\arabic{problem@score}\setcounter{problem@score}{0}}

\let\postword\relax

% Miscellaneous templates

% \jeolmhrule
\newlength{\jeolmhrule@width}%
\newlength{\jeolmhrule@textwidth}%
\newcommand\jeolmhrule[1]{\begingroup\let\sp\quad
\settowidth{\jeolmhrule@textwidth}{\hbox{\strut\sp#1\sp\strut}}%
\jeolmhrule@width=0.5\textwidth%
\addtolength{\jeolmhrule@width}{-0.5\jeolmhrule@textwidth}%
\rule[0.5ex]{\jeolmhrule@width}{0.5pt}%
\sp#1\sp
\rule[0.5ex]{\jeolmhrule@width}{0.5pt}
\endgroup}

% \jeolmtournheader template
\newcommand\jeolmtournheadertemplate[3]{%
{\Large\vspace{4ex}}\par%
\begingroup\small\sffamily
\strut\hfill{\bfseries#1}\hfill\strut\\[0.3ex]%
\strut\hfill{\itshape#3}\qquad{#2}\hfill\strut{\large\bfseries\\[0.3ex]%
\ifx\jeolmleague\relax\rule[0.5ex]{\textwidth}{0.5pt}\else
    \jeolmhrule{\jeolmleague}\fi}%
\endgroup
\vspace{-\parskip}
\@ifnextchar*{\@gobble}{{\Large\vspace{-4ex}}}}
\let\jeolmleague\relax

\let\jeolmheader\relax

% \regattacaption template
\newcommand\regattablankcaptiontemplate[5]{%
\parbox{0.66\textwidth}{
\vspace{1ex}
\textbf{\Large{#4}}
\par\vspace{2ex}
\textbf{#1:}\ \hbox to 10em{\hrulefill}
\vspace{1ex}}%
\parbox{0.33\textwidth}{
\setlength{\fboxsep}{2em}
\texttt{#2{:}\ }\fbox{\phantom{S}}
\par\vspace{1ex}
\texttt{#3{:}\ #5}}%
\vspace{3ex}}

%%%%%%%%%%
% Problem/solution segregation

% High-level dispatch
\newenvironment{tourn-problems}[1]%
    {\def\problem@tourn@env{tourn-problems/#1}%
        \begin{\problem@tourn@env}}%
    {\end{\problem@tourn@env}}
\newcommand\tournproblem[1]{\def\problem@tourn@number{\itemy{#1}}}
\newenvironment{tourn-problems/problems}
    {\begin{problems}\let\problem\problem@tourn@problem}%
    {\end{problems}}%
\newenvironment{tourn-problems/blank}
    {\begin{problems}\let\problem\problem@tourn@problem}%
    {\end{problems}}%
\newenvironment{tourn-problems/solutions}%
    {\begin{problems}\let\problem\problem@tourn@solution}%
    {\end{problems}}%
\newenvironment{tourn-problems/complete}%
    {\begin{problems}\let\problem\problem@tourn@complete}%
    {\end{problems}}
\newenvironment{tourn-problems/jury}%
    {\begin{problems}\let\problem\problem@tourn@complete}%
    {\end{problems}}%

% Selection/formatting 
\long\def\problem@tourn@complete#1\endproblem{\begingroup
\problem@tourn@parse#1\endproblem
{\problem@tourn@fetched@preproblem}{\problem@tourn@fetched@presolution}%
\problem@tourn@number\problem@tourn@fetched@problem
\par\solution@delimiter\problem@tourn@fetched@solution\par
\endgroup}
\long\def\problem@tourn@problem#1\endproblem{\begingroup
\problem@tourn@parse#1\endproblem
{\problem@tourn@fetched@preproblem}%
\problem@tourn@number\problem@tourn@fetched@problem\par
\endgroup}
\long\def\problem@tourn@solution#1\endproblem{\begingroup
\problem@tourn@parse#1\endproblem
{\problem@tourn@fetched@presolution}%
\problem@tourn@number\problem@tourn@fetched@solution\par
\endgroup}

% Parsing/segregation
\long\def\problem@tourn@parse#1\solution#2\endproblem{%
    \@ifnextchar[%
        {\problem@tourn@parse@preproblem}%
        {\problem@tourn@parse@problem}#1\endproblem%
    \@ifnextchar[%
        {\problem@tourn@parse@presolution}%
        {\problem@tourn@parse@solution}#2\endsolution%
}
\long\def\problem@tourn@parse@preproblem[#1]#2\endproblem{%
    \long\def\problem@tourn@fetched@preproblem{#1}%
    \long\def\problem@tourn@fetched@problem{#2}}
\long\def\problem@tourn@parse@problem#1\endproblem{%
    \long\def\problem@tourn@fetched@preproblem{}%
    \long\def\problem@tourn@fetched@problem{#1}}
\long\def\problem@tourn@parse@presolution[#1]#2\endsolution{%
    \long\def\problem@tourn@fetched@presolution{#1}%
    \long\def\problem@tourn@fetched@solution{#2}}
\long\def\problem@tourn@parse@solution#1\endsolution{%
    \long\def\problem@tourn@fetched@presolution{}%
    \long\def\problem@tourn@fetched@solution{#1}}

\newcommand\solution@delimiter{$\square$\quad}

